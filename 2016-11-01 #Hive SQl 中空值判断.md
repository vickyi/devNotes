#### Hive SQl 中空值判断

##### 1. `NULL` 与 `\N`
hive在底层数据中如何保存和标识NULL，是由 
```
alter table name SET SERDEPROPERTIES('serialization.null.format' = '\N');
```
参数控制的

比如：

- 设置 1 
```
alter table name SET SERDEPROPERTIES('serialization.null.format' = '\N');
```

则：底层数据保存的是`\N`, 通过查询显示的是`NULL`

这时如果查询为空值的字段可通过 语句：a is null 或者 a='\\N'

- 设置 2
```
alter tablename SET SERDEPROPERTIES('serialization.null.format' = 'NULL'); 
```
则：底层数据保存的是`NULL`,通过查询显示的是`NULL`

这时如果查询为空值的字段可通过 语句：a is null 或者 a='NULL'

##### '' 与 length(xxx)=0
`''` 表示的是字段不为`NULL`且为空字符串，此时用 `a is null` 是无法查询这种值的，必须通过 `a=''`  或者 `length(a)=0` 查询

#### hive中的NULL(hive空值处理)

[原文在此](http://www.voidcn.com/blog/longshenlmj/article/p-6019851.html)

> HIVE中默认将NULL存为\N，可以在线上用hadoop fs -cat查看源文件，文件中存储大量\N，   这样量大会浪费大量空间。如果用java、python操作源数据时要注意解析。

>    另外，hive表的源文件中默认，列分隔符为\001(SOH)，行分隔符(即换行符)为\n（目前只支持\n，别的不能用，所以定义时不需要显示声明）。元素间分隔符\002，map中key和value的分隔符为\003。

如源文件中一条记录为：
```
10000042SOH77SOH435SOH16SOH22SOH1156120000SOH\NSOH\NSOH\NSOH\NSOH\NSOH\NSOH\NSOHyoukuSOH85133.0SOH111
```

可以看出存储NULL的\N 浪费了大量空间。

##### Hive的NULL有时候是必须的：
- Hive中insert语句必须列数匹配，否则不写入。没有值的列必须使用null占位。
- Hive表的数据文件中按分隔符区分各个列。空列会保存NULL（\n）来保留列位置。但外部表加载某些数据时如果列不够，如表13列，文件数据只有2列，则在表查询时表中的末尾剩余列无数据对应，自动显示为NULL。

所以，NULL转化为空字符串，可以节省磁盘空间

语句为
```
alter table $hive_tb set serdeproperties('serialization.null.format' = '');
```
OR
```
CREATE TABLE $hive_tb (id int,name STRING) 
ROW FORMAT SERDE ‘org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe’ WITH SERDEPROPERTIES ( ‘field.delim’='/t’, ‘escape.delim’='//’, ‘serialization.null.format’=” ) STORED AS TEXTFILE;
```

节省空间结果如下：
```
hadoop fs -du /hivedata/warehouse/pmp.db/tb_test_log_basic_analysis/day=2016-05-14/type=1/media=sohu/0*
#### 1137

hadoop fs -du /hivedata/warehouse/pmp.db/tb_test_log_basic_analysis/day=2016-05-14/type=1/media=youku/0*
### 319753
    
hadoop fs -du /hivedata/warehouse/pmp.db/tb_null_test_log_basic_analysis/day=2016-05-14/type=1/media=sohu/0*
885
    
hadoop fs -du /hivedata/warehouse/pmp.db/tb_null_test_log_basic_analysis/day=2016-05-14/type=1/media=youku/0*
249529
```
